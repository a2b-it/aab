<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"	
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:int="http://www.springframework.org/schema/integration"
	xmlns:int-http="http://www.springframework.org/schema/integration/http"	
	xmlns:int-ftp="http://www.springframework.org/schema/integration/ftp"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="
	http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd
    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration.xsd
    http://www.springframework.org/schema/integration/http 
    http://www.springframework.org/schema/integration/http/spring-integration-http.xsd
    http://www.springframework.org/schema/integration/ftp 
    http://www.springframework.org/schema/integration/ftp/spring-integration-ftp.xsd">
	
	
	<bean id="ftpClientFactory"
    class="org.springframework.integration.ftp.session.DefaultFtpSessionFactory">
	    <property name="host" value="127.0.0.1"/>
	    <property name="port" value="2121"/>
	    <property name="username" value="admin"/>
	    <property name="password" value="admin"/>
	    <property name="clientMode" value="0"/>
	    <property name="fileType" value="2"/>
	    <property name="bufferSize" value="100000"/>
	</bean>
	
	<int:gateway id="gwLs" service-interface="com.apiweather.app.flow.FtpLsGateway"
		default-request-channel="inbound" default-reply-channel="results"/>

	<int:gateway id="gwGet" service-interface="com.apiweather.app.flow.FtpGetGateway"
		default-request-channel="inboundFile" default-reply-channel="toLocal"/>
		
	<int-ftp:outbound-gateway id="gatewayLS"			
		session-factory="ftpClientFactory"		
		request-channel="inbound"		
		command="ls"
		command-options=""
		expression="payload"	
		reply-channel="results"	
		>		
	</int-ftp:outbound-gateway>
	
	<int-ftp:outbound-gateway id="gatewayGET"
		local-directory="F://INDAR//dss//FTP_out"
		remote-directory="/ftp/one/"
		session-factory="ftpClientFactory"
		request-channel="inboundFile"
		reply-channel="toLocal"
		command="get"
		command-options="-P"
		expression="payload">
		<int-ftp:request-handler-advice-chain>
			<int:retry-advice max-attempts="3" />
		</int-ftp:request-handler-advice-chain>
	</int-ftp:outbound-gateway>

	<int:channel id="inbound">
		<int:interceptors>
		 <int:wire-tap channel="logging"/>
		</int:interceptors>
	</int:channel>
	
	<int:channel id="results"/>		
	
	<int:channel id="inboundFile">
		
	</int:channel>
	
	<int:channel id="toLocal">
	<int:interceptors>
		 <int:wire-tap channel="logging"/>
		</int:interceptors>
	</int:channel>		

	<int:logging-channel-adapter id="logging" log-full-message="true"/>
	<!-- 
	<int:splitter id="splitter" input-channel="toSplitter" output-channel="toGet"/>
			
	<int-ftp:outbound-gateway id="gatewayGET"
		local-directory="F://docker//ftp"
		remote-directory="/ftp/one/"
		session-factory="ftpClientFactory"
		request-channel="toGet"
		reply-channel="aggregateResultsChannel"
		command="get"
		command-options="-P"
		expression="payload.remoteDirectory + '/' + payload.filename">
		<int-ftp:request-handler-advice-chain>
			<int:retry-advice max-attempts="3" />
		</int-ftp:request-handler-advice-chain>
	</int-ftp:outbound-gateway>
	
	<int:aggregator input-channel="aggregateResultsChannel"/>

	
	
	<int-ftp:inbound-channel-adapter id="ftpInbound"
				channel="ftpChannel"
				session-factory="ftpClientFactory"
				filename-pattern="*.txt"
				auto-create-local-directory="true"
				delete-remote-files="false"
				remote-directory="/"
				local-directory="F://docker//ftp">
							<int:poller fixed-rate=""> </int:poller>
	</int-ftp:inbound-channel-adapter>

	<int:channel id="ftpChannel">
		<int:queue/>
	</int:channel>
	-->
</beans>